import styles from "./Overview.module.css";

import { Database } from "@/lib/supabase";
import { createServerComponentClient } from "@supabase/auth-helpers-nextjs";
import { redirect } from "next/navigation";
import { cookies } from "next/headers";
import { getPrenumerationer } from "@/lib/Prenumerationer";
import Link from "next/link";
import Kategori from "@/components/Kategori/Kategori";
import OverviewSection from "@/components/overviewSection/overviewSection";
import AnnualCostInCarrot from "@/components/annualCostInCarrot/annualCostInCarrot";

export const dynamic = 'force-dynamic';

export default async function Överblick() {
  const supabase = createServerComponentClient<Database>({ cookies });
  const {
    data: { session },
  } = await supabase.auth.getSession();

  /* Redirect if not login */
  if (!session) {
    redirect('/login');
  }

  /* Get the cache data */
  const prenumerationer = await getPrenumerationer();

  return (
    <>
      <h1 className="h1 text-black">Överblick</h1>

      <div className={styles.grid}>
        <OverviewSection prenumerationer={prenumerationer} />
        <section className={`${styles.topRating} ${styles.gridFull} bg-white`}>
          <Link className="h3 text-accent" href={'#'}>Sveriges topp 5 prenumerationer</Link>
        </section>

        <Kategori prenumerationer={prenumerationer} />

        <section className={`${styles.sparaSection} ${styles.smallCardGrid} bg-white`}>
          <h2 className="h3">Skapa sparplan</h2>
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
            <path d="M18 7.71429H10.2857V0H7.71429V7.71429H0V10.2857H7.71429V18H10.2857V10.2857H18V7.71429Z" fill="black" />
          </svg>
          <svg className={styles.pig} xmlns="http://www.w3.org/2000/svg" width="73" height="72" viewBox="0 0 73 72" fill="none">
            <g clipPath="url(#clip0_422_1063)">
              <path d="M39.9392 20.94C35.7172 20.115 31.3492 20.4749 27.3192 21.98C27.1235 22.0574 26.945 22.1727 26.7939 22.3192C26.6428 22.4656 26.522 22.6404 26.4384 22.8336C26.2696 23.2236 26.2627 23.6648 26.4192 24.06C26.5757 24.4551 26.8827 24.772 27.2728 24.9407C27.6629 25.1095 28.104 25.1164 28.4992 24.96C31.9691 23.648 35.7331 23.3158 39.3792 24C39.5929 24.0562 39.816 24.0676 40.0343 24.0333C40.2527 23.9991 40.4615 23.92 40.6478 23.801C40.834 23.682 40.9936 23.5257 41.1165 23.342C41.2393 23.1583 41.3228 22.9511 41.3616 22.7336C41.4004 22.516 41.3937 22.2927 41.3419 22.0779C41.2901 21.863 41.1944 21.6612 41.0608 21.4852C40.9272 21.3092 40.7585 21.1627 40.5655 21.0551C40.3724 20.9475 40.1592 20.8811 39.9392 20.86V20.94Z" fill="#0043CA" />
              <path d="M51.2591 36.14C52.7613 36.14 53.9791 34.9223 53.9791 33.42C53.9791 31.9178 52.7613 30.7 51.2591 30.7C49.7568 30.7 48.5391 31.9178 48.5391 33.42C48.5391 34.9223 49.7568 36.14 51.2591 36.14Z" fill="#0043CA" />
              <path d="M71.5202 37.26C71.3349 36.9858 71.0844 36.7618 70.7912 36.6082C70.498 36.4547 70.1712 36.3762 69.8402 36.38C68.2244 36.1557 66.7419 35.3613 65.6602 34.14C63.5788 31.865 61.8099 29.3226 60.4002 26.58L66.1602 17.58C66.5098 17.0585 66.7239 16.4581 66.7832 15.8331C66.8426 15.208 66.7453 14.5781 66.5002 14C66.2548 13.4742 65.8838 13.0167 65.4199 12.668C64.9561 12.3192 64.4136 12.0898 63.8402 12C60.1773 11.5064 56.4492 12.0252 53.0602 13.5C51.118 14.3555 49.2905 15.4507 47.6202 16.76C44.349 15.2932 40.8657 14.3549 37.3002 13.98C23.1202 12.6 10.1602 21.8 8.50024 34C7.85331 33.709 7.27391 33.2867 6.7988 32.76C6.32368 32.2332 5.96321 31.6135 5.74024 30.94C5.59764 30.4783 5.54895 29.9926 5.59704 29.5117C5.64513 29.0308 5.78902 28.5644 6.02024 28.14C6.22759 27.7837 6.52393 27.4874 6.88024 27.28C7.12319 27.133 7.33478 26.9395 7.50295 26.7106C7.67112 26.4818 7.79256 26.222 7.86035 25.9462C7.92813 25.6704 7.94094 25.384 7.89802 25.1033C7.85511 24.8225 7.75732 24.553 7.61024 24.31C7.46316 24.0671 7.26967 23.8555 7.04081 23.6873C6.81196 23.5192 6.55222 23.3977 6.27643 23.3299C6.00064 23.2621 5.7142 23.2493 5.43346 23.2923C5.15272 23.3352 4.88319 23.433 4.64024 23.58C3.67208 24.1743 2.87313 25.0077 2.32024 26C1.80621 26.9314 1.48307 27.9559 1.36975 29.0136C1.25642 30.0713 1.35518 31.141 1.66024 32.16C2.03574 33.3949 2.65843 34.5406 3.49047 35.5273C4.32251 36.5141 5.34651 37.3214 6.50024 37.9L8.34024 38.82C8.57011 43.6886 9.80967 48.4561 11.9802 52.82L12.3202 53.58C14.0549 57.2488 16.2675 60.6718 18.9002 63.76C19.0877 63.9734 19.3184 64.1444 19.577 64.2616C19.8356 64.3789 20.1163 64.4397 20.4002 64.44H29.4402C29.7678 64.4384 30.09 64.3563 30.3784 64.2011C30.6668 64.0458 30.9127 63.822 31.0944 63.5495C31.2761 63.2769 31.3881 62.9639 31.4205 62.6379C31.4529 62.312 31.4047 61.983 31.2802 61.68L30.5002 59.88L32.8602 60.14C35.5204 60.403 38.2001 60.403 40.8602 60.14C41.6002 61.34 42.4002 62.54 43.2802 63.72C43.4644 63.9721 43.7051 64.1776 43.9829 64.32C44.2607 64.4624 44.5681 64.5377 44.8802 64.54H53.5602C53.8903 64.5398 54.2152 64.4578 54.506 64.3014C54.7967 64.1451 55.0442 63.9192 55.2264 63.6439C55.4086 63.3686 55.5198 63.0525 55.5501 62.7238C55.5805 62.3951 55.529 62.064 55.4002 61.76C55.0602 60.96 54.7202 60.1 54.4602 59.36C54.1002 58.3 53.8202 57.36 53.6002 56.46C55.809 55.2676 57.8362 53.7658 59.6202 52C61.613 52.2409 63.6275 52.2409 65.6202 52C65.966 51.9478 66.292 51.8057 66.5657 51.5882C66.8394 51.3706 67.0513 51.0851 67.1802 50.76L71.7002 39.14C71.8274 38.8361 71.8775 38.5054 71.8461 38.1775C71.8147 37.8495 71.7028 37.5343 71.5202 37.26ZM63.9602 48.14C62.3902 48.2294 60.8151 48.1557 59.2602 47.92C57.4897 47.621 55.7803 47.0331 54.2002 46.18C53.7323 45.948 53.1922 45.9082 52.6953 46.0692C52.1984 46.2302 51.7842 46.5792 51.5413 47.0416C51.2983 47.504 51.2459 48.043 51.3952 48.5436C51.5445 49.0441 51.8837 49.4663 52.3402 49.72C53.1761 50.1583 54.0377 50.5457 54.9202 50.88C53.8296 51.8112 52.6188 52.5915 51.3202 53.2L49.2002 54.16C49.2002 54.16 50.1802 58.54 50.8402 60.48H46.0802C45.6002 59.8 43.1802 55.76 43.1802 55.76L41.8402 55.94C39.0255 56.3459 36.1734 56.4264 33.3402 56.18C32.0202 56.06 29.8202 55.78 28.1002 55.48L25.0002 54.94C25.0002 54.94 26.2602 59.8 26.5002 60.42H21.3402C19.2325 57.8392 17.446 55.0118 16.0202 52L15.6602 51.22C13.0616 46.2179 11.9643 40.5713 12.5002 34.96C13.5802 24.58 24.7402 16.74 36.8802 17.88C40.4118 18.2759 43.8487 19.2772 47.0402 20.84L48.2802 21.42L49.2802 20.48C50.8376 19.0884 52.5978 17.9419 54.5002 17.08C57.0173 15.9883 59.767 15.5415 62.5002 15.78L55.7402 26.36L56.2402 27.36C57.987 30.8783 60.215 34.1362 62.8602 37.04C64.0889 38.2408 65.5437 39.1857 67.1402 39.82L63.9602 48.14Z" fill="#0043CA" />
            </g>
            <defs>
              <clipPath id="clip0_422_1063">
                <rect width="72" height="72" fill="white" transform="translate(0.5)" />
              </clipPath>
            </defs>
          </svg>
        </section>

        <AnnualCostInCarrot prenumerationer={prenumerationer} />
        
      </div>
    </>
  )
}